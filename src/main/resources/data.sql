-- MySQL Script generated by MySQL Workbench
-- Fri Apr 29 00:18:22 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

DROP TABLE IF EXISTS school;
DROP TABLE IF EXISTS department;
DROP TABLE IF EXISTS speciality;
DROP TABLE IF EXISTS group_;
DROP TABLE IF EXISTS student;
DROP TABLE IF EXISTS science_degree;
DROP TABLE IF EXISTS student_work;
DROP TABLE IF EXISTS student_work_type;
DROP TABLE IF EXISTS scientific_work;
DROP TABLE IF EXISTS teacher;
DROP TABLE IF EXISTS academic_position;
DROP TABLE IF EXISTS science_specialization;
DROP TABLE IF EXISTS teacher_specialization;
-- -----------------------------------------------------
-- Table `mydb`.`school`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`school` (
  `school_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(256) NOT NULL,
  PRIMARY KEY (`school_id`));


-- -----------------------------------------------------
-- Table `mydb`.`department`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`department` (
  `department_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(256) NOT NULL,
  `school_id` INT NOT NULL,
  PRIMARY KEY (`department_id`),
  INDEX `fk_department` (`school_id` ASC) VISIBLE,
  CONSTRAINT `fk_department`
    FOREIGN KEY (`school_id`)
    REFERENCES `mydb`.`school` (`school_id`));


-- -----------------------------------------------------
-- Table `mydb`.`speciality`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`speciality` (
  `speciality_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  `department_id` INT NOT NULL,
  PRIMARY KEY (`speciality_id`),
  INDEX `fk_speciality` (`department_id` ASC) VISIBLE,
  CONSTRAINT `fk_speciality`
    FOREIGN KEY (`department_id`)
    REFERENCES `mydb`.`department` (`department_id`));


-- -----------------------------------------------------
-- Table `mydb`.`group_`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`group_` (
  `group_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  `enrollment_year` INT NOT NULL,
  `course` INT NOT NULL,
  `speciality_id` INT NOT NULL,
  PRIMARY KEY (`group_id`),
  INDEX `fk_group` (`speciality_id` ASC) VISIBLE,
  CONSTRAINT `fk_group`
    FOREIGN KEY (`speciality_id`)
    REFERENCES `mydb`.`speciality` (`speciality_id`));


-- -----------------------------------------------------
-- Table `mydb`.`student`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`student` (
  `student_id` INT AUTO_INCREMENT NOT NULL,
  `last_name` VARCHAR(128) NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  `patronymic` VARCHAR(128) NOT NULL,
  `email` VARCHAR(512) NOT NULL,
  `personal_id` INT NOT NULL,
  `group_id` INT NOT NULL,
  PRIMARY KEY (`student_id`),
  INDEX `fk_student` (`group_id` ASC) VISIBLE,
  CONSTRAINT `fk_student`
    FOREIGN KEY (`group_id`)
    REFERENCES `mydb`.`group_` (`group_id`));


-- -----------------------------------------------------
-- Table `mydb`.`academic_position`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`academic_position` (
  `acad_pos_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  PRIMARY KEY (`acad_pos_id`));


-- -----------------------------------------------------
-- Table `mydb`.`science_degree`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`science_degree` (
  `degree_id` INT AUTO_INCREMENT NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  PRIMARY KEY (`degree_id`));


-- -----------------------------------------------------
-- Table `mydb`.`teacher`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`teacher` (
  `teacher_id` INT AUTO_INCREMENT NOT NULL,
  `last_name` VARCHAR(128) NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  `patronymic` VARCHAR(128) NOT NULL,
  `email` VARCHAR(128) NOT NULL,
  `personal_id` INT NOT NULL,
  `acad_pos_id` INT NOT NULL,
  `department_id` INT NOT NULL,
  `degree_id` INT NOT NULL,
  PRIMARY KEY (`teacher_id`),
  INDEX `fk_teacher_acad_pos` (`acad_pos_id` ASC) VISIBLE,
  INDEX `fk_teacher_department` (`department_id` ASC) VISIBLE,
  INDEX `fk_teacher_degree` (`degree_id` ASC) VISIBLE,
  CONSTRAINT `fk_teacher_acad_pos`
    FOREIGN KEY (`acad_pos_id`)
    REFERENCES `mydb`.`academic_position` (`acad_pos_id`),
  CONSTRAINT `fk_teacher_department`
    FOREIGN KEY (`department_id`)
    REFERENCES `mydb`.`department` (`department_id`),
  CONSTRAINT `fk_teacher_degree`
    FOREIGN KEY (`degree_id`)
    REFERENCES `mydb`.`science_degree` (`degree_id`));


-- -----------------------------------------------------
-- Table `mydb`.`scientific_work`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`scientific_work` (
  `work_id` INT AUTO_INCREMENT NOT NULL,
  `title` VARCHAR(512) NOT NULL,
  `teacher_id` INT NOT NULL,
  PRIMARY KEY (`work_id`),
  INDEX `fk_scientific_work` (`teacher_id` ASC) VISIBLE,
  CONSTRAINT `fk_scientific_work`
    FOREIGN KEY (`teacher_id`)
    REFERENCES `mydb`.`teacher` (`teacher_id`));


-- -----------------------------------------------------
-- Table `mydb`.`student_work_type`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`student_work_type` (
  `type` VARCHAR(128) NOT NULL,
  `name` VARCHAR(128) NOT NULL,
  PRIMARY KEY (`type`));


-- -----------------------------------------------------
-- Table `mydb`.`student_work`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`student_work` (
  `student_id` INT NOT NULL,
  `work_id` INT NOT NULL,
  `title` VARCHAR(512) NOT NULL,
  `start_date` DATE NULL DEFAULT NULL,
  `completion_date` DATE NULL DEFAULT NULL,
  `score` INT DEFAULT NULL,
  `leave_reason` VARCHAR(128) DEFAULT NULL,
  `type` VARCHAR(128) NOT NULL,
  PRIMARY KEY (`student_id`, `work_id`),
  INDEX `fk_student_work_2` (`work_id` ASC) VISIBLE,
  INDEX `fk_student_work_student_work_type1_idx` (`type` ASC) VISIBLE,
  CONSTRAINT `fk_student_work_1`
    FOREIGN KEY (`student_id`)
    REFERENCES `mydb`.`student` (`student_id`),
  CONSTRAINT `fk_student_work_2`
    FOREIGN KEY (`work_id`)
    REFERENCES `mydb`.`scientific_work` (`work_id`),
  CONSTRAINT `fk_student_work_student_work_type1`
    FOREIGN KEY (`type`)
    REFERENCES `mydb`.`student_work_type` (`type`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `science_specialization` (
    `specialization_id` int NOT NULL AUTO_INCREMENT,
    `name` varchar(128) NOT NULL,
    PRIMARY KEY (`specialization_id`)
);

CREATE TABLE `teacher_specialization` (
    `teacher_id` int NOT NULL,
    `specialization_id` int NOT NULL,
    PRIMARY KEY (`teacher_id`,`specialization_id`),
    INDEX `fk_specialization_idx` (`specialization_id` ASC) VISIBLE,
    INDEX `fk_teacher_idx` (`teacher_id` ASC) VISIBLE ,
    CONSTRAINT `fk_specialization` FOREIGN KEY (`specialization_id`) REFERENCES `science_specialization` (`specialization_id`),
    CONSTRAINT `fk_teacher` FOREIGN KEY (`teacher_id`) REFERENCES `teacher` (`teacher_id`)
);

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


-- -----------------------------------------------------
-- inserts
-- -----------------------------------------------------
INSERT INTO student_work_type (type, name) VALUES ('ТП' ,'Творческий проект');
INSERT INTO student_work_type (type, name) VALUES ('Пр' ,'Научно-исследовательский проект');
INSERT INTO student_work_type (type, name) VALUES ('НС' ,'Научная статья');
INSERT INTO student_work_type (type, name) VALUES ('Д'  ,'Диссертация');
INSERT INTO student_work_type (type, name) VALUES ('П'  ,'Публикация');

INSERT INTO school (school_id, name) VALUES (1,'ИШИТР');
INSERT INTO school (school_id, name) VALUES (2,'ИЯТШ');
INSERT INTO school (school_id, name) VALUES (3,'ИШПР');
INSERT INTO school (school_id, name) VALUES (4,'ИШЭ');
INSERT INTO school (school_id, name) VALUES (5,'ИШНКБ');

INSERT INTO academic_position (acad_pos_id, name) VALUES (1,'Старший преподаватель');
INSERT INTO academic_position (acad_pos_id, name) VALUES (2,'Преподаватель');
INSERT INTO academic_position (acad_pos_id, name) VALUES (3,'Ассистент');
INSERT INTO academic_position (acad_pos_id, name) VALUES (4,'Лаборант');
INSERT INTO academic_position (acad_pos_id, name) VALUES (5,'Старший лаборант');

INSERT INTO science_degree (degree_id, name) VALUES (1,'Магистр');
INSERT INTO science_degree (degree_id, name) VALUES (2,'Кандидат наук');
INSERT INTO science_degree (degree_id, name) VALUES (3,'Доктор наук');
INSERT INTO science_degree (degree_id, name) VALUES (4,'Доцент');
INSERT INTO science_degree (degree_id, name) VALUES (5,'Бакалавр');

INSERT INTO department (department_id, name, school_id) VALUES (1,'Отделение автоматизации и робототехники',1);
INSERT INTO department (department_id, name, school_id) VALUES (2,'Отделение экспериментальной физики',2);
INSERT INTO department (department_id, name, school_id) VALUES (3,'Отделение геологии',3);
INSERT INTO department (department_id, name, school_id) VALUES (4,'Отделение электроэнергетики и электротехники',4);
INSERT INTO department (department_id, name, school_id) VALUES (5,'Отделение контроля и диагностики',5);

INSERT INTO speciality (speciality_id, name, department_id) VALUES (1,'15.03.06 Мехатроника и робототехника',1);
INSERT INTO speciality (speciality_id, name, department_id) VALUES (2,'03.03.02 Физика',2);
INSERT INTO speciality (speciality_id, name, department_id) VALUES (3,'21.05.03 Технология геологической разведки',3);
INSERT INTO speciality (speciality_id, name, department_id) VALUES (4,'13.03.02 Электроэнергетика и электротехника',4);
INSERT INTO speciality (speciality_id, name, department_id) VALUES (5,'12.03.01 Приборостроение',5);

INSERT INTO group_ (group_id, name, enrollment_year, course, speciality_id)
            VALUES (1,'8Е81',2018,4,1);
INSERT INTO group_ (group_id, name, enrollment_year, course, speciality_id)
            VALUES (2,'8Д81',2018,4,2);
INSERT INTO group_ (group_id, name, enrollment_year, course, speciality_id)
            VALUES (3,'0291',2019,3,3);
INSERT INTO group_ (group_id, name, enrollment_year, course, speciality_id)
            VALUES (4,'8Т81',2018,4,4);
INSERT INTO group_ (group_id, name, enrollment_year, course, speciality_id)
            VALUES (5,'0В81',2020,4,5);

INSERT INTO teacher (teacher_id, last_name, name, patronymic, email, personal_id, acad_pos_id, department_id, degree_id)
VALUES (1,'Севостьянова','Ольга','Дмитриевна','sod@tpu.ru',10001,1,1,1);
INSERT INTO teacher (teacher_id, last_name, name, patronymic, email, personal_id, acad_pos_id, department_id, degree_id)
VALUES (2,'Окружной','Алексей','Патронович','oap@tpu.ru',10002,2,2,2);
INSERT INTO teacher (teacher_id, last_name, name, patronymic, email, personal_id, acad_pos_id, department_id, degree_id)
VALUES (3,'Александрова','Валентина','Витальевна','avv@tpu.ru',10003,3,3,3);
INSERT INTO teacher (teacher_id, last_name, name, patronymic, email, personal_id, acad_pos_id, department_id, degree_id)
VALUES (4,'Сидоров','Евгений','Евгеньевич','see@tpu.ru',10004,4,4,4);
INSERT INTO teacher (teacher_id, last_name, name, patronymic, email, personal_id, acad_pos_id, department_id, degree_id)
VALUES (5,'Ого','Заци','-','zazi@tpu.ru',10005,5,5,5);

INSERT INTO student (student_id, last_name, name, patronymic, email, personal_id, group_id)
            VALUES (1,'Иванов','Иван','Иванович','iii@tpu.ru',1,1);
INSERT INTO student (student_id, last_name, name, patronymic, email, personal_id, group_id)
            VALUES (2,'Сергеев','Сергей','Сергеевич','sss@tpu.ru',2,1);
INSERT INTO student (student_id, last_name, name, patronymic, email, personal_id, group_id)
            VALUES (3,'Петров','Петр','Петрович','ppp@tpu.ru',3,3);
INSERT INTO student (student_id, last_name, name, patronymic, email, personal_id, group_id)
            VALUES (4,'Денисов','Денис','Денисович','ddd@tpu.ru',4,5);
INSERT INTO student (student_id, last_name, name, patronymic, email, personal_id, group_id)
            VALUES (5,'Михайлов','Михаил','Михайлович','mmm@tpu.ru',5,5);

INSERT INTO scientific_work (work_id, title, teacher_id) VALUES (1,'Создание мобильного приложения на Android',1);
INSERT INTO scientific_work (work_id, title, teacher_id) VALUES (2,'VR тренажер на Unity3D',2);
INSERT INTO scientific_work (work_id, title, teacher_id) VALUES (3,'Распознавание лиц с помощью библиотеки Tesseract',3);
INSERT INTO scientific_work (work_id, title, teacher_id) VALUES (4,'Проектирование системы расписания ТПУ',5);
INSERT INTO scientific_work (work_id, title, teacher_id) VALUES (5,'Облачное приложение для помощи бездомным животным',2);

INSERT INTO student_work (student_id, work_id, title, start_date, completion_date, score, type)
            VALUES (1,1,'Создание мобильного приложения на Android','2018-09-01','2018-12-01',5,'ТП');
INSERT INTO student_work (student_id, work_id, title, start_date, completion_date, score, type)
            VALUES (2,2,'VR тренажер на Unity3D','2018-09-01','2018-12-01',4,'ТП');
INSERT INTO student_work (student_id, work_id, title, start_date, completion_date, score, type)
            VALUES (3,3,'Распознавание лиц с помощью библиотеки Tesseract','2020-09-01','2020-12-03',4,'Пр');
INSERT INTO student_work (student_id, work_id, title, start_date, completion_date, score, type)
            VALUES (4,4,'Проектирование системы расписания ТПУ','2021-09-01','2022-01-20',5,'Пр');
INSERT INTO student_work (student_id, work_id, title, start_date, completion_date, score, type)
            VALUES (5,4,'Проектирование системы расписания ТПУ','2021-09-01','2022-01-20',5,'Пр');

INSERT INTO science_specialization(specialization_id, name) VALUES (1, 'Машинное обучение');
INSERT INTO science_specialization(specialization_id, name) VALUES (2, 'Big Data');
INSERT INTO science_specialization(specialization_id, name) VALUES (3, 'Web-разработка');
INSERT INTO science_specialization(specialization_id, name) VALUES (4, 'Мобильная разработка');
INSERT INTO science_specialization(specialization_id, name) VALUES (5, 'Структурная геология');

INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (1, 1);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (1, 2);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (2, 2);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (2, 4);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (3, 1);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (3, 2);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (3, 3);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (4, 5);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (5, 1);
INSERT INTO teacher_specialization(teacher_id, specialization_id) VALUES (5, 2);